<!doctype html><html lang=fr dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="La gestion des dépendances# Dès qu’un programme devient un peu plus complexe, deux phénomènes interviennent habituellement :
Le programme est décomposé en plusieurs modules Certaines fonctionnalités du programmes peuvent être accomplies par des programmes (ou des librairies) externes Dans le cas (2), on nomme parfois les librairies externes des “dépendances”, ou des “paquets” (packages en anglais, plus communément).
Dans les débuts de l’ingénierie logicielle, ces dépendances étaient gérées à la main, en copiant et échangeant des fichiers.
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://cjauvin.github.io/inf1410-teluq/docs/module3/gestion-des-deps/"><meta property="og:site_name" content="INF1410 - Initiation au génie logiciel"><meta property="og:title" content="La gestion des dépendances"><meta property="og:description" content="La gestion des dépendances# Dès qu’un programme devient un peu plus complexe, deux phénomènes interviennent habituellement :
Le programme est décomposé en plusieurs modules Certaines fonctionnalités du programmes peuvent être accomplies par des programmes (ou des librairies) externes Dans le cas (2), on nomme parfois les librairies externes des “dépendances”, ou des “paquets” (packages en anglais, plus communément).
Dans les débuts de l’ingénierie logicielle, ces dépendances étaient gérées à la main, en copiant et échangeant des fichiers."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="La gestion des dépendances"><meta itemprop=description content="La gestion des dépendances# Dès qu’un programme devient un peu plus complexe, deux phénomènes interviennent habituellement :
Le programme est décomposé en plusieurs modules Certaines fonctionnalités du programmes peuvent être accomplies par des programmes (ou des librairies) externes Dans le cas (2), on nomme parfois les librairies externes des “dépendances”, ou des “paquets” (packages en anglais, plus communément).
Dans les débuts de l’ingénierie logicielle, ces dépendances étaient gérées à la main, en copiant et échangeant des fichiers."><meta itemprop=wordCount content="1993"><title>La gestion des dépendances | INF1410 - Initiation au génie logiciel</title><link rel=icon href=https://cjauvin.github.io/inf1410-teluq/images/2gears.png><link rel=manifest href=https://cjauvin.github.io/inf1410-teluq/manifest.json><link rel=canonical href=https://cjauvin.github.io/inf1410-teluq/docs/module3/gestion-des-deps/><link rel=stylesheet href=https://cjauvin.github.io/inf1410-teluq/book.min.427fd74effaa6729c02a67f5c2fcf3aacdee5c04af08e6536e0f6fc0b2d61589.css integrity="sha256-Qn/XTv+qZynAKmf1wvzzqs3uXASvCOZTbg9vwLLWFYk=" crossorigin=anonymous><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link rel=stylesheet href=https://cjauvin.github.io/inf1410-teluq/css/applet.css></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=https://cjauvin.github.io/inf1410-teluq/><img src=https://cjauvin.github.io/inf1410-teluq/images/2gears.png alt=Logo><span>INF1410 - Initiation au génie logiciel</span></a></h2><ul><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/environnements/>Environnements du cours</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/travaux-not%C3%A9s/>Travaux notés</a></li><li><input type=checkbox id=section-ceede6672d79ee87ce5f1a12533f0f89 class=toggle>
<label for=section-ceede6672d79ee87ce5f1a12533f0f89 class=flex><a href=https://cjauvin.github.io/inf1410-teluq/docs/module1/>Module 1 - Le génie logiciel</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module1/intro-gl/>Qu'est-ce que le génie logiciel?</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module1/historique/>Les idées historiques importantes</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module1/historique2/>Survol historiquee des jalons du GL</a></li></ul></li><li><input type=checkbox id=section-6bcde8c955d2ef4a29812289ee291845 class=toggle>
<label for=section-6bcde8c955d2ef4a29812289ee291845 class=flex><a href=https://cjauvin.github.io/inf1410-teluq/docs/module2/>Module 2 - La programmation</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module2/prog-recap/>Survol rapide de la programmation</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module2/principes/>Principes généraux fameux</a></li></ul></li><li><input type=checkbox id=section-dacaf5bf92061137876427d5274f80b8 class=toggle checked>
<label for=section-dacaf5bf92061137876427d5274f80b8 class=flex><a href=https://cjauvin.github.io/inf1410-teluq/docs/module3/>Module 3 - Les outils et les environnements</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module3/versioning/>Le versioning avec git</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module3/docker/>La conteneurisation avec docker</a></li><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module3/gestion-des-deps/ class=active>La gestion des dépendances</a></li></ul></li><li><input type=checkbox id=section-d43313f1368df8488a83030094191c31 class=toggle>
<label for=section-d43313f1368df8488a83030094191c31 class=flex><a href=https://cjauvin.github.io/inf1410-teluq/docs/module4/>Module 4 - La gestion de projet et la collaboration</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=https://cjauvin.github.io/inf1410-teluq/docs/module4/agile/>Le manifeste Agile</a></li></ul></li><li><input type=checkbox id=section-a26973bae2fed65c6fe8fb0151c28c36 class=toggle>
<label for=section-a26973bae2fed65c6fe8fb0151c28c36 class=flex><a href=https://cjauvin.github.io/inf1410-teluq/docs/module5/>Module 5 - Les données</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li><li><input type=checkbox id=section-e048a05c5e3f3e77303c39a90f95ec11 class=toggle>
<label for=section-e048a05c5e3f3e77303c39a90f95ec11 class=flex><a role=button>Module 6 - L'infonuagique</a>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=https://cjauvin.github.io/inf1410-teluq/icons/menu.svg class=book-icon alt=Menu></label><h3>La gestion des dépendances</h3><label for=toc-control><img src=https://cjauvin.github.io/inf1410-teluq/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#le-versionnage-sémantique--semver>Le versionnage sémantique : SemVer</a></li><li><a href=#le-gestionnaire-uv-pour-python>Le gestionnaire <code>uv</code> pour Python</a><ul><li><a href=#la-librairie-my-lib>La librairie <code>my-lib</code></a></li><li><a href=#lapplication-my-app-qui-utilise-la-librairie-my-lib>L’application <code>my-app</code> (qui utilise la librairie <code>my-lib</code>)</a></li><li><a href=#la-librairie-my-lib-évolue>La librairie <code>my-lib</code> évolue</a></li><li><a href=#lapplication-my-app-devrait-donc-évoluer-elle-aussi->L’application <code>my-app</code> devrait donc évoluer elle aussi !</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=la-gestion-des-dépendances>La gestion des dépendances<a class=anchor href=#la-gestion-des-d%c3%a9pendances>#</a></h1><p>Dès qu&rsquo;un programme devient un peu plus complexe, deux phénomènes interviennent
habituellement :</p><ol><li>Le programme est décomposé en plusieurs modules</li><li>Certaines fonctionnalités du programmes peuvent être accomplies par des
programmes (ou des librairies) externes</li></ol><p>Dans le cas (2), on nomme parfois les librairies externes des &ldquo;dépendances&rdquo;, ou des
&ldquo;paquets&rdquo; (packages en anglais, plus communément).</p><p>Dans les débuts de l&rsquo;ingénierie logicielle, ces dépendances étaient gérées à la
main, en copiant et échangeant des fichiers.</p><p>Avec l&rsquo;apparition de Linux au début des années 90, une innovation importante
allait vite apparaître : les gestionnaire de paquets. Des exemples fameux sont
<a href=https://fr.wikipedia.org/wiki/Advanced_Packaging_Tool>APT</a> pour les
distributions Debian et Ubuntu de Linux, et
<a href=https://fr.wikipedia.org/wiki/RPM_Package_Manager>RPM</a> pour d&rsquo;autres
distributions comme Red Hat, Fedora, etc.</p><p>Ces paquets sont en général des programmes et des librairies qui sont
compatibles avec une version particulière de Linux et des sous-systèmes qui sont
présents dans une distribution particulière. Par exemple si on utilise Ubuntu
24.04, une version particulière d&rsquo;une distribution particulière de Linux basée
sur Debian, le gestionnaire de paquets <code>apt</code> ne permettra que d&rsquo;installer des
programmes compatibles avec Ubuntu 24.04. Non seulement la compatibilité des versions
est gérée au niveau du système global, mais aussi entre les paquets (programmes ou librairies, entre eux). Si par exemple l&rsquo;installation de la version 7 de LibreOffice
nécessite une version particulière de Java, le gestionnaire de paquets gérera les
dépendances intelligemment, et automatiquement.</p><h2 id=le-versionnage-sémantique--semver>Le versionnage sémantique : SemVer<a class=anchor href=#le-versionnage-s%c3%a9mantique--semver>#</a></h2><p>Au fil du temps et de l&rsquo;évolution de la culture du développement logiciel, le
versionnage dit <em>sémantique</em> (SemVer) s&rsquo;est imposé en tant que convention pour numéroter
les versions d&rsquo;un logiciel, que ce soit un programme ou une librairie.</p><label class=book-image for=book-image-toggle-0><input class="hidden toggle" type=checkbox id=book-image-toggle-0>
<img src=https://cjauvin.github.io/inf1410-teluq/docs/module3/gestion-des-deps/semver.png alt loading=lazy title>
</label><script>(function(){const e=document.getElementById("book-image-toggle-0"),t=function(t){t.key==="Escape"&&e.checked&&(e.checked=!1)};e.addEventListener("change",function(){this.checked?document.addEventListener("keydown",t):document.removeEventListener("keydown",t)})})()</script><p>Bien que l&rsquo;interprétation ne soit pas toujours identique, en général on
s&rsquo;accorde pour dire que la composante &ldquo;majeure&rdquo; du numéro de version correspond
à un changement important, qui &ldquo;brise&rdquo; la compatibilité avec les versions
précédentes (s&rsquo;il y en a). S&rsquo;il s&rsquo;agit d&rsquo;une librairie logicielle par exemple,
la mise à jour demandera probablement un travail assez important, non-trivial.</p><p>Le deuxième nombre, la version mineure, indique l’ajout de nouvelles
fonctionnalités qui demeurent compatibles avec l’existant. Le logiciel
s’enrichit, mais sans obliger les utilisateurs à modifier leur code. Enfin, le
troisième nombre, appelé correctif ou patch, correspond à des réparations
internes : corrections de bugs, améliorations de performance ou failles de
sécurité qui ne modifient pas l’interface offerte aux autres programmes.</p><p>Grâce à cette structure simple, un numéro de version devient une véritable
promesse. Il permet aux équipes de décider automatiquement quelles mises à jour
peuvent être installées sans risque et lesquelles exigent une attention
particulière. Les gestionnaires de dépendances modernes s’appuient largement sur
cette logique pour éviter les surprises. Sans une convention partagée, une
nouvelle version pourrait tout aussi bien contenir une amélioration bénigne
qu’un changement radical rendant l’application inutilisable.</p><p>Adopter SemVer revient donc à instaurer une relation de confiance entre les
mainteneurs d’un logiciel et celles et ceux qui l’intègrent dans leurs propres
projets. Le numéro n’est plus simplement un identifiant : il devient une
information sur la stabilité, la continuité et l’effort requis pour évoluer avec
le produit.</p><p>Il est à noter que bien que SemVer soit le schéma le plus répandu, il en existe
d&rsquo;autres : Ubuntu par exemple utilise des numéros de version qui correspondent à
l&rsquo;année et au mois de livraison d&rsquo;une certaine version.</p><p>Il y a aussi une notion assez populaire, qui consiste à considérer qu&rsquo;un
logiciel ou une librairie ne peut pas être considérée <em>stable</em> tant qu&rsquo;elle n&rsquo;a
pas atteint au moins la version <code>1.0.0</code>. Certains projets restent d&rsquo;ailleurs
indéfiniment dans un schéma de versions <code>0.x.y</code>, afin d&rsquo;échapper à une certaine
pression sociale, et ainsi pouvoir conserver une certaine liberté créative et
d&rsquo;action.</p><p>Il est à noter que pour les langages de programmation (qui sont à la fois des
programmes et des librairies), la question du numéro de version est
particulièrement cruciale et parfois même controversée. Un cas fameux est la
transition de la version 2 du langage Python, à la version 3, qui était prévue
devoir être relativement simple et rapide, mais qui a pris au moins 10 ans à
intervenir, étant donné toute la complexité technique et sociale que cette
transition a entraînée.</p><p>La notion de versionnage sémantique est tellement importante et omniprésente
qu&rsquo;elle a de l&rsquo;influence à l&rsquo;extérieur de la sphère du développement logiciel.
On parlera ainsi de la Playstation 5, de la Mazda 3, etc. Même des choses qui
pourraient à priori ressembler à du logiciel, comme le <a href=https://fr.wikipedia.org/wiki/Web_2.0>Web
2.0</a> et le
<a href=https://fr.wikipedia.org/wiki/Web3>Web3</a>, n&rsquo;en sont pas vraiment, ils sont
plus des &ldquo;évolutions culturelles et technologiques&rdquo;.</p><h2 id=le-gestionnaire-uv-pour-python>Le gestionnaire <code>uv</code> pour Python<a class=anchor href=#le-gestionnaire-uv-pour-python>#</a></h2><p>Pour explorer concrètement ces idées, nous allons utiliser le gestionnaire
de librairies <code>uv</code>, pour Python.</p><h3 id=la-librairie-my-lib>La librairie <code>my-lib</code><a class=anchor href=#la-librairie-my-lib>#</a></h3><p>Nous allons tout d&rsquo;abord créer, avec <code>uv</code>, une petite librairie simple, qui
n&rsquo;offrira qu&rsquo;une seule fonction :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv init --lib my-lib
</span></span><span style=display:flex><span>Initialized project <span style=color:#e6db74>`</span>my-lib<span style=color:#e6db74>`</span> at <span style=color:#e6db74>`</span>.../uv-demo2/my-lib<span style=color:#e6db74>`</span></span></span></code></pre></div><p>La structure initiale de notre nouveau projet de librairie devrait ressembler à
ceci :</p><pre tabindex=0><code>my-lib/
├── pyproject.toml
├── src/
│   └── my_lib/
│       └── __init__.py</code></pre><p><code>uv</code> a créé la structure de notre librairie, mais il n&rsquo;a évidemment pas fourni
le code qu&rsquo;on veut y offrir, qu&rsquo;il nous faut définir nous-même, dans le fichier
<code>src/my_lib/secret.py</code> (qui doit être créé) :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_secret_number</span>():
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>42</span></span></span></code></pre></div><p>Le projet ressemble donc maintenant à ceci :</p><pre tabindex=0><code>my-lib/
├── pyproject.toml
├── src/
│   └── my_lib/
│       ├── __init__.py
│       └── secret.py      ← contient notre fonction get_secret_number</code></pre><p>On peut tout d&rsquo;abord tester notre librairie avec cette commande :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd my-lib
</span></span><span style=display:flex><span>$ uv run python -c <span style=color:#e6db74>&#39;from my_lib.secret import get_secret_number; print(get_secret_number())&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>42</span></span></span></code></pre></div><p>On doit ensuite produire un artefact de type <code>wheel</code>, qui va contenir la totalité
de notre librairie, en un seul fichier <code>.whl</code> (qu&rsquo;il sera possible pour un autre projet
d&rsquo;installer) :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd my-lib
</span></span><span style=display:flex><span>$ uv build --out-dir ../packages
</span></span><span style=display:flex><span>Building source distribution <span style=color:#f92672>(</span>uv build backend<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>Building wheel from source distribution <span style=color:#f92672>(</span>uv build backend<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>Successfully built ../packages/my_lib-0.1.0.tar.gz
</span></span><span style=display:flex><span>Successfully built ../packages/my_lib-0.1.0-py3-none-any.whl</span></span></code></pre></div><p>Voici maintenant où nous en sommes :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── my-lib
</span></span><span style=display:flex><span>│   ├── pyproject.toml
</span></span><span style=display:flex><span>│   ├── README.md
</span></span><span style=display:flex><span>│   ├── src
</span></span><span style=display:flex><span>│   │   └── my_lib
</span></span><span style=display:flex><span>│   │       ├── __init__.py
</span></span><span style=display:flex><span>│   │       ├── __pycache__
</span></span><span style=display:flex><span>│   │       │   ├── __init__.cpython-313.pyc
</span></span><span style=display:flex><span>│   │       │   └── secret.cpython-313.pyc
</span></span><span style=display:flex><span>│   │       ├── py.typed
</span></span><span style=display:flex><span>│   │       └── secret.py
</span></span><span style=display:flex><span>│   └── uv.lock
</span></span><span style=display:flex><span>└── packages
</span></span><span style=display:flex><span>    ├── my_lib-0.1.0-py3-none-any.whl
</span></span><span style=display:flex><span>    └── my_lib-0.1.0.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> directories, <span style=color:#ae81ff>10</span> files</span></span></code></pre></div><h3 id=lapplication-my-app-qui-utilise-la-librairie-my-lib>L&rsquo;application <code>my-app</code> (qui utilise la librairie <code>my-lib</code>)<a class=anchor href=#lapplication-my-app-qui-utilise-la-librairie-my-lib>#</a></h3><p>Créons maintenant un nouveau projet avec <code>uv</code>, d&rsquo;une application cette fois, que
nous appellerons <code>my-app</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd ..  <span style=color:#75715e># on doit être au même niveau que my-lib</span>
</span></span><span style=display:flex><span>$ uv init my-app
</span></span><span style=display:flex><span>Initialized project <span style=color:#e6db74>`</span>my-app<span style=color:#e6db74>`</span> at <span style=color:#e6db74>`</span>.../uv-demo2/my-app<span style=color:#e6db74>`</span></span></span></code></pre></div><p>Étant donné que <code>my-app</code> devra utiliser le code de la librairie <code>my-lib</code>, nous
voudrons y ajouter une dépendance vers notre librairie <code>my-lib</code>. Mais tout
d&rsquo;abord, étant donné que ceci est un exercice d&rsquo;apprentissage, nous devons
modifier notre configuration quelque peu, en ajoutant le bloc <code>[tool.uv]</code> qui
contient deux lignes supplémentaires, à notre fichier <code>my-app/pyproject.toml</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>project</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;my-app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Add your description here&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readme</span> = <span style=color:#e6db74>&#34;README.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires-python</span> = <span style=color:#e6db74>&#34;&gt;=3.13&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dependencies</span> = []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>uv</span>]
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>no-index</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>find-links</span> = [<span style=color:#e6db74>&#34;../packages&#34;</span>]</span></span></code></pre></div><p>Ces deux lignes sont très importantes dans notre contexte :</p><ol><li><code>no-index</code> empêche <code>uv</code> d&rsquo;aller chercher <code>my-lib</code> sur le dépôt public <a href=https://pypi.org>PyPI</a>, qui contient déjà apparemment une <a href=https://pypi.org/project/my-lib/>librairie avec ce nom</a>. Nous voulons que <code>uv</code> utilise notre version locale de <code>my-lib</code>, que nous avons sur notre propre disque</li><li><code>find-links</code> indique le lieu où <code>uv</code> devra trouver les fichiers &ldquo;wheels&rdquo;, qui sont des sortes de &ldquo;zip&rdquo; d&rsquo;une librairie entière, optimisée pour un système particulier</li></ol><p>Une fois cette configuration effectuée, on peut ajouter notre dépendance avec <code>uv add</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd my-app
</span></span><span style=display:flex><span>$ uv add my-lib
</span></span><span style=display:flex><span>Using CPython 3.13.5
</span></span><span style=display:flex><span>Creating virtual environment at: .venv
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 26ms
</span></span><span style=display:flex><span>Prepared <span style=color:#ae81ff>1</span> package in 4ms
</span></span><span style=display:flex><span>Installed <span style=color:#ae81ff>1</span> package in 3ms
</span></span><span style=display:flex><span> + my-lib<span style=color:#f92672>==</span>0.1.0</span></span></code></pre></div><p>On peut constater l&rsquo;état du projet de notre application avec cette commande :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv tree
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 3ms
</span></span><span style=display:flex><span>my-app v0.1.0
</span></span><span style=display:flex><span>└── my-lib v0.1.0</span></span></code></pre></div><p>Tout comme nous l&rsquo;avons fait pour <code>my-lib</code>, c&rsquo;est à nous qu&rsquo;incombe la
responsabilité de fournir le code source pour l&rsquo;application, qui sera très
simple. Dans le fichier <code>my-app/main.py</code> (qui a été créé automatiquement par <code>uv</code>
puisqu&rsquo;il s&rsquo;agissait d&rsquo;une application), nous devons remplacer le contenu par :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> my_lib.secret <span style=color:#f92672>import</span> get_secret_number
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;The secret number is: </span><span style=color:#e6db74>{</span>get_secret_number()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()</span></span></code></pre></div><p>On peut maintenant tester notre application :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd my-app
</span></span><span style=display:flex><span>$ uv run main.py
</span></span><span style=display:flex><span>The secret number is: <span style=color:#ae81ff>42</span></span></span></code></pre></div><p>Maintenant regardons attentivement notre fichier <code>my-app/pyproject.toml</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>project</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;my-app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Add your description here&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readme</span> = <span style=color:#e6db74>&#34;README.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires-python</span> = <span style=color:#e6db74>&#34;&gt;=3.13&#34;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>dependencies</span> = [
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#e6db74>&#34;my-lib&gt;=0.1.0&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>uv</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>no-index</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>find-links</span> = [<span style=color:#e6db74>&#34;../packages&#34;</span>]</span></span></code></pre></div><p>On note que <code>my-app</code> définie sa dépendance à <code>my-lib</code> en spécifiant : n&rsquo;importe quelle
version de <code>my-lib</code> dont la version est plus grande ou égale à <code>0.1.0</code>. Ceci peut
être dangereux, car que se passerait-il dans le cas où une nouvelle version de <code>my-lib</code>
serait publiée, et qu&rsquo;elle contiendra des changements qui feraient en sorte de modifier
le comportement de <code>my-app</code>? Soyons plus conservateur en fixant plus précisément notre
limite de version pour <code>my-lib</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv add <span style=color:#e6db74>&#34;my-lib&gt;=0.1.0,&lt;0.2.0&#34;</span>
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 7ms
</span></span><span style=display:flex><span>Audited <span style=color:#ae81ff>1</span> package in 0.28ms</span></span></code></pre></div><p>On peut maintenant constater l&rsquo;effet de cette précision dans notre même fichier
<code>my-app/pyproject.toml</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>project</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;my-app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Add your description here&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readme</span> = <span style=color:#e6db74>&#34;README.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires-python</span> = <span style=color:#e6db74>&#34;&gt;=3.13&#34;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>dependencies</span> = [
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#e6db74>&#34;my-lib&gt;=0.1.0,&lt;0.2.0&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>uv</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>no-index</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>find-links</span> = [<span style=color:#e6db74>&#34;../packages&#34;</span>]</span></span></code></pre></div><p>La version de <code>my-lib</code> pour <code>my-map</code> est &ldquo;pinnée&rdquo; (mot anglais) à <code>0.1.x</code>, ce
qui veut donc dire que seules les versions avec des &ldquo;patchs&rdquo; différents (pour la
résolution de bogues, en général) seront tolérées : par exemple <code>0.1.1</code>,
<code>0.1.2</code>, etc. La version <code>0.2.0</code>, si elle en venait à exister, serait
&ldquo;interdite&rdquo; par le gestionnaire <code>uv</code> (remarquez bien l&rsquo;usage de <code>&lt;0.2.0</code>, et
non <code>&lt;=0.2.0</code>).</p><h3 id=la-librairie-my-lib-évolue>La librairie <code>my-lib</code> évolue<a class=anchor href=#la-librairie-my-lib-%c3%a9volue>#</a></h3><p>Imaginons maintenant que la librairie <code>my-lib</code> évolue, et que la fonction
offerte change : par exemple, au lieu d&rsquo;être 42, le nombre magique devient 99.
Modifions tout d&rsquo;abord le code de <code>my-lib/src/secret.py</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_secret_number</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>99</span></span></span></code></pre></div><p>Ensuite incrémentons la version de <code>my-lib</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd my-lib
</span></span><span style=display:flex><span>$ uv version --bump minor  <span style=color:#75715e># 0.1.0 -&gt; 0.2.0</span>
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>1</span> package in 16ms
</span></span><span style=display:flex><span>      Built my-lib @ file:///Users/cjauvin/gh/inf1410-teluq/content/docs/module3/gestion-de
</span></span><span style=display:flex><span>Prepared <span style=color:#ae81ff>1</span> package in 7ms
</span></span><span style=display:flex><span>Uninstalled <span style=color:#ae81ff>1</span> package in 0.67ms
</span></span><span style=display:flex><span>Installed <span style=color:#ae81ff>1</span> package in 1ms
</span></span><span style=display:flex><span> - my-lib<span style=color:#f92672>==</span>0.1.0 <span style=color:#f92672>(</span>from file:///Users/cjauvin/gh/inf1410-teluq/content/docs/module3/gestion-des-deps/uv-demo3/my-lib<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> + my-lib<span style=color:#f92672>==</span>0.2.0 <span style=color:#f92672>(</span>from file:///Users/cjauvin/gh/inf1410-teluq/content/docs/module3/gestion-des-deps/uv-demo3/my-lib<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>my-lib 0.1.0 <span style=color:#f92672>=</span>&gt; 0.2.0</span></span></code></pre></div><p>On peut constater dans notre fichier <code>my-lib/pyproject.toml</code> que le changement a
été fait :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>project</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;my-lib&#34;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.2.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Add your description here&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readme</span> = <span style=color:#e6db74>&#34;README.md&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>authors</span> = [
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;Christian Jauvin&#34;</span>, <span style=color:#a6e22e>email</span> = <span style=color:#e6db74>&#34;cjauvin@gmail.com&#34;</span> }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires-python</span> = <span style=color:#e6db74>&#34;&gt;=3.13&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dependencies</span> = []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>build-system</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires</span> = [<span style=color:#e6db74>&#34;uv_build&gt;=0.8.22,&lt;0.9.0&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>build-backend</span> = <span style=color:#e6db74>&#34;uv_build&#34;</span></span></span></code></pre></div><p>On peut maintenant &ldquo;builder&rdquo; notre librairie afin d&rsquo;en produire un artefact de type
&ldquo;wheel&rdquo; pour la nouvelle version <code>0.2.0</code>, comme nous avons fait pour la précédente
version <code>0.1.0</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv build --out-dir ../packages
</span></span><span style=display:flex><span>Building source distribution <span style=color:#f92672>(</span>uv build backend<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>Building wheel from source distribution <span style=color:#f92672>(</span>uv build backend<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>Successfully built ../packages/my_lib-0.2.0.tar.gz
</span></span><span style=display:flex><span>Successfully built ../packages/my_lib-0.2.0-py3-none-any.whl</span></span></code></pre></div><p>On constate donc la présence du fichier <code>../packages/my_lib-0.2.0-py3-none-any.whl</code>, qui
contient la totalité de notre librairie, prête à être installée dans le contexte de
n&rsquo;importe quel projet, par <code>uv</code>.</p><h3 id=lapplication-my-app-devrait-donc-évoluer-elle-aussi->L&rsquo;application <code>my-app</code> devrait donc évoluer elle aussi !<a class=anchor href=#lapplication-my-app-devrait-donc-%c3%a9voluer-elle-aussi->#</a></h3><p>Retournons maintenant à <code>my-app</code>. Si on tente de la mettre à jour :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv sync --upgrade
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 17ms
</span></span><span style=display:flex><span>Audited <span style=color:#ae81ff>1</span> package in 0.28ms</span></span></code></pre></div><p>Rien ne se passe, car bien que <code>my-lib</code> version <code>0.2.0</code> soit disponible, la
configuration de <code>my-app</code> ne la permet pas. Pour changer cela, on peut utiliser
la commande :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>uv add <span style=color:#e6db74>&#34;my-lib&gt;=0.1.0,&lt;=0.2.0&#34;</span>
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 17ms
</span></span><span style=display:flex><span>Audited <span style=color:#ae81ff>1</span> package in 0.23ms</span></span></code></pre></div><p>qui devrait maintenant permettre de faire en sorte de laisser passer la version <code>0.2.0</code>
de <code>my-lib</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv sync --upgrade
</span></span><span style=display:flex><span>Resolved <span style=color:#ae81ff>2</span> packages in 26ms
</span></span><span style=display:flex><span>Prepared <span style=color:#ae81ff>1</span> package in 0.78ms
</span></span><span style=display:flex><span>Uninstalled <span style=color:#ae81ff>1</span> package in 1ms
</span></span><span style=display:flex><span>Installed <span style=color:#ae81ff>1</span> package in 1ms
</span></span><span style=display:flex><span> - my-lib<span style=color:#f92672>==</span>0.1.0
</span></span><span style=display:flex><span> + my-lib<span style=color:#f92672>==</span>0.2.0</span></span></code></pre></div><p>On peut finalement constater l&rsquo;effet de cette mise à niveau de <code>my-lib</code>, sur notre
application elle-même :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>$ uv run main.py
</span></span><span style=display:flex><span>The secret number is: <span style=color:#ae81ff>99</span></span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=https://cjauvin.github.io/inf1410-teluq/docs/module3/docker/ class="flex align-center"><img src=https://cjauvin.github.io/inf1410-teluq/icons/backward.svg class=book-icon alt=Backward>
<span>La conteneurisation avec docker</span>
</a></span><span><a href=https://cjauvin.github.io/inf1410-teluq/docs/module4/ class="flex align-center"><span>Module 4 - La gestion de projet et la collaboration</span>
<img src=https://cjauvin.github.io/inf1410-teluq/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#le-versionnage-sémantique--semver>Le versionnage sémantique : SemVer</a></li><li><a href=#le-gestionnaire-uv-pour-python>Le gestionnaire <code>uv</code> pour Python</a><ul><li><a href=#la-librairie-my-lib>La librairie <code>my-lib</code></a></li><li><a href=#lapplication-my-app-qui-utilise-la-librairie-my-lib>L’application <code>my-app</code> (qui utilise la librairie <code>my-lib</code>)</a></li><li><a href=#la-librairie-my-lib-évolue>La librairie <code>my-lib</code> évolue</a></li><li><a href=#lapplication-my-app-devrait-donc-évoluer-elle-aussi->L’application <code>my-app</code> devrait donc évoluer elle aussi !</a></li></ul></li></ul></nav></div></aside></main></body></html>